<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Brickognize Minifig Test</title>
</head>
<body>
  <h1>üß± Upload a LEGO Minifigure Image</h1>
  <input type="file" id="fileInput" accept="image/*" />
  <div id="output" style="margin-top: 20px;"></div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const output = document.getElementById('output');

    fileInput.onchange = async function (e) {
      const file = e.target.files[0];
      if (!file) {
        output.textContent = '‚ùå No file selected.';
        return;
      }

      output.innerHTML = 'üì§ Uploading image to Brickognize...';

      const formData = new FormData();
      formData.append('query_image', file, file.name);

      try {
        const res = await fetch('https://api.brickognize.com/predict/', {
          method: 'POST',
          body: formData
        });

        const json = await res.json();

        if (json.items && json.items.length > 0) {
          output.innerHTML = `<h3>‚úÖ Matches Found (${json.items.length}):</h3>`;
          json.items.forEach(item => {
            const div = document.createElement('div');
            div.style.marginBottom = '16px';
            div.innerHTML = `
              <img src="${item.img_url}" alt="${item.name}" style="width:100px;"><br>
              <strong>${item.name}</strong><br>
              ID: ${item.id}<br>
              <a href="${item.external_sites[0].url}" target="_blank">View on BrickLink</a>
            `;
            output.appendChild(div);
          });
        } else {
          output.textContent = '‚ùå No minifig match found.';
        }
      } catch (err) {
        console.error(err);
        output.textContent = '‚ùå Failed to contact Brickognize or parse response.';
      }
    };
  </script>
</body>
</html>